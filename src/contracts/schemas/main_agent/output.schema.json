{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "main_agent_output",
  "title": "MainAgent Output Contract",
  "description": "Output from the Main Agent - orchestration results and generated files",
  "type": "object",
  "required": [
    "target_url",
    "generated_files",
    "sub_agent_results"
  ],
  "properties": {
    "target_url": {
      "type": "string",
      "format": "uri",
      "description": "The website URL that was analyzed"
    },
    "generated_files": {
      "type": "object",
      "description": "Files generated by the Main Agent",
      "required": [
        "plan_md",
        "test_md",
        "test_data_jsonl"
      ],
      "properties": {
        "plan_md": {
          "type": "object",
          "description": "The comprehensive crawl plan document",
          "required": [
            "path",
            "generated"
          ],
          "properties": {
            "path": {
              "type": "string",
              "description": "File path where plan.md was saved"
            },
            "generated": {
              "type": "boolean",
              "description": "Whether the file was successfully generated"
            },
            "sections": {
              "type": "array",
              "description": "Sections included in the plan",
              "items": {
                "type": "string",
                "enum": [
                  "scope",
                  "start_urls",
                  "listing_selectors",
                  "pagination",
                  "detail_selectors",
                  "data_model",
                  "configuration",
                  "accessibility",
                  "sample_data",
                  "notes"
                ]
              }
            }
          }
        },
        "test_md": {
          "type": "object",
          "description": "The test dataset documentation",
          "required": [
            "path",
            "generated"
          ],
          "properties": {
            "path": {
              "type": "string",
              "description": "File path where test.md was saved"
            },
            "generated": {
              "type": "boolean",
              "description": "Whether the file was successfully generated"
            }
          }
        },
        "test_data_jsonl": {
          "type": "object",
          "description": "The JSONL test dataset file",
          "required": [
            "path",
            "generated"
          ],
          "properties": {
            "path": {
              "type": "string",
              "description": "File path where test_set.jsonl was saved"
            },
            "generated": {
              "type": "boolean",
              "description": "Whether the file was successfully generated"
            },
            "entry_count": {
              "type": "integer",
              "description": "Number of test entries in the file"
            }
          }
        }
      }
    },
    "sub_agent_results": {
      "type": "object",
      "description": "Aggregated results from all sub-agents",
      "required": [
        "discovery",
        "selector",
        "accessibility",
        "test_data"
      ],
      "properties": {
        "discovery": {
          "type": "object",
          "description": "Results from DiscoveryAgent (BrowserAgent)",
          "properties": {
            "completed": {
              "type": "boolean",
              "description": "Whether discovery phase completed successfully"
            },
            "pagination_type": {
              "type": "string",
              "enum": [
                "numbered",
                "load_more",
                "infinite_scroll",
                "url_parameter",
                "none"
              ],
              "description": "Detected pagination type"
            },
            "pagination_max_pages": {
              "type": "integer",
              "description": "Maximum pagination depth detected"
            },
            "extracted_articles_count": {
              "type": "integer",
              "description": "Number of article URLs discovered"
            }
          }
        },
        "selector": {
          "type": "object",
          "description": "Results from SelectorAgent",
          "properties": {
            "completed": {
              "type": "boolean",
              "description": "Whether selector discovery completed successfully"
            },
            "listing_selectors_found": {
              "type": "boolean",
              "description": "Whether listing selectors were found"
            },
            "detail_selectors_found": {
              "type": "boolean",
              "description": "Whether detail selectors were found"
            },
            "fields_discovered": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of article fields for which selectors were found"
            }
          }
        },
        "accessibility": {
          "type": "object",
          "description": "Results from AccessibilityAgent",
          "properties": {
            "completed": {
              "type": "boolean",
              "description": "Whether accessibility check completed"
            },
            "requires_browser": {
              "type": "boolean",
              "description": "Whether JavaScript rendering is needed"
            },
            "listing_accessible": {
              "type": "boolean",
              "description": "Whether listing pages are HTTP accessible"
            },
            "articles_accessible": {
              "type": "boolean",
              "description": "Whether article pages are HTTP accessible"
            }
          }
        },
        "test_data": {
          "type": "object",
          "description": "Results from TestDataAgent",
          "properties": {
            "completed": {
              "type": "boolean",
              "description": "Whether test data generation completed"
            },
            "listing_count": {
              "type": "integer",
              "description": "Number of listing entries created"
            },
            "article_count": {
              "type": "integer",
              "description": "Number of article entries created"
            },
            "export_path": {
              "type": "string",
              "description": "Path where test data was exported"
            }
          }
        }
      }
    },
    "workflow_summary": {
      "type": "object",
      "description": "Summary of the orchestration workflow",
      "properties": {
        "phases_completed": {
          "type": "integer",
          "minimum": 0,
          "maximum": 5,
          "description": "Number of workflow phases completed (out of 5)"
        },
        "success": {
          "type": "boolean",
          "description": "Whether the overall workflow succeeded"
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Any errors encountered during orchestration"
        },
        "notes": {
          "type": "string",
          "description": "Human-readable summary of the workflow execution"
        }
      }
    },
    "agent_response_content": {
      "type": "string",
      "description": "Natural language summary of the agent's response, explaining key findings and decisions in human-readable form"
    }
  },
  "additionalProperties": false
}
